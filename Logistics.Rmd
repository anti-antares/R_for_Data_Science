---
title: "R Notebook"
output: html_notebook
---

Data cleaning 
```{r}
library(tidyverse)
library(DataExplorer)

poverty <- read_csv(file = "Train.csv")
poverty_test <-read_csv(file ="Test.csv")
poverty$tag <-"Train"
poverty_test$tag <-"Test"

poverty_test $Target <-1
poverty_total <- rbind(poverty,poverty_test)
poverty_total <- poverty_total %>% mutate(Target=as.factor(Target))
poverty_total$v2a1 <-NULL  #NA
poverty_total$v18q1 <-NULL  #NA
poverty_total$rez_esc <-NULL #NA   #33413
#names(which(sapply(poverty_total, anyNA)))
poverty_total$meaneduc <-NULL
poverty_total$SQBmeaned <-NULL

poverty_total$dependency <- NULL
poverty_total$idhogar <-NULL
```



Distribution 
room normally distributed 
size of household left skewed
```{r}
##recode the variables 
##do the distribution by categories 
##recode完成之后 再加变量或者根据前面data 介绍部分的分类来确定要做哪些variables的distribution

a<-ggplot(poverty,aes(x=rooms))+geom_bar()+ylab("Count")+xlab("Number of All Rooms in the House")

b<-ggplot(poverty,aes(x=tamhog))+geom_bar()+ylab("Count")+xlab("Size of the Household")

c<-ggplot(poverty,aes(x=escolari))+geom_bar()+ylab("Count")+xlab("Years of Schooling")

grid.arrange(a,b,c, nrow = 3,top="Distribution Analysis")

```

PCA

the first 10 variables explain ...% of the variances.
According to the graph, the most 

explain what are PC1 and PC2 

pc1:
hogar_total, # of total individuals in the household
r4t3, Total persons in the household
hhsize, household size
...

pc2: 
cielorazo, =1 if the house has ceiling
r4m2, Females 12 years of age and older
....

```{r}

poverty_numerical = poverty_total %>% select_if(is.numeric)  ## get the numerical columns 
poverty_numerical$elimbasu5 <- NULL

library(factoextra)
fviz_eig(full_pca)
full_pca = prcomp(poverty_numerical, center = TRUE, scale. = TRUE)

fviz_pca_var(full_pca,
             col.var = "contrib", # Color by contributions to the PC
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             select.var = list(contrib = 20), # top 20 contributing
             repel = TRUE     # Avoid text overlapping
             )

# view <- full_pca$rotation
# to view how to interpret the coefficients 
# might be too many 

```


Some additional data handling 

```{r}


poverty_total= poverty_total %>% 
  cbind(full_pca$x[,1:10])
poverty_train <- subset(poverty_total, tag=="Train")
poverty_test <- subset(poverty_total, tag=="Test")
poverty_test$Target <-NULL




```


Multi_nomial

```{r}

library(nnet)
library(caret)

poverty_multinolog <- multinom(Target ~PC1+PC2+PC3+PC4+PC5+PC6+PC7+PC8+PC9+PC10, data=poverty_train)
summary(poverty_multinolog)

poverty_log_prediction_train <- predict(object = poverty_multinolog, newdata = poverty_train) 
## table(actual = poverty_train$Target, predict = poverty_log_prediction_train)
## confusionMatrix(poverty_log_prediction_train, poverty_train$Target)

poverty_log_prediction_test <- predict(object = poverty_multinolog, newdata = poverty_test)
##confusionMatrix(poverty_log_prediction_test, poverty_test$Target)

result <-data.frame(poverty_test$Id,poverty_log_prediction_test)
colnames(result) <-c("Id","Target")
write.csv(result,"submission_shuting.csv",row.names = FALSE)


```



